<div class="text-center mt-5 mb-5">
  <div class="form-wrapper">
    <h4 class="form-title  mb-3"><%= @form_title %></h4>      
    <%= form_with(model: post, local: true) do |form| %>
    <% if post.errors.any? %>
        <div id="error_explanation">
            <ul>
                <% post.errors.full_messages.each do |message| %>
                <div class="form-error-message">
                    <%= message %><br>
                </div>
                <% end %>
            </ul>
        </div>
    <% end %>
    <img src="" class="img-preview">
    
    <% if post.image.attached? %>
        <div class="form-text">現在の画像</div>
        <%= image_tag post.image,class:"img-preview" %>
    <% end %>
    
    <div class="field form-group text-left" onchange="previewFile()">
       <div class="form-text mb-3">画像を選択してください</div><br />
       <%= form.file_field :image,class:"image",id:"file" ,class:"form-control-file"%>
    </div>
      
    <div class="field form-group text-left">
        <div class="form-text  mb-3"><span class="badge badge-danger mr-1">※必須</span> 魚種</div><br />
        <%= form.text_field :name,class:"form-control",placeholder:"カタカナで入力して下さい"%>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3"><span class="badge badge-danger">※必須</span> 数量</div><br />
        <%= form.number_field :number,class:"form-control" ,value:1 %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">サイズ(cm)</div><br />
        <%= form.number_field :size,class:"form-control" %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">日付</div><br />
        <%= form.date_select :date ,{}, {class: "form-control"} %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">時間帯(時)</div><br />
        <%= form.time_select :time ,{}, {class: "form-control"} %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">説明</div><br />
        <%= form.text_field :description,class:"form-control" %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">使った餌</div><br />
        <%= form.select :feed, [["アオイソメ"], ["ゴカイ"],["オキアミ"],["カニ"],["貝"],["配合エサ"],["ミミズ"],["アカムシ"],["練エサ"],["ルアー"],["魚切り身"]],{:prompt => "エサを選択してください"},{class:"form-control"} %>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3">天気</div><br />
        <%= form.select :weather,[["晴れ"], ["曇り"],["雨"],["その他"]],{:prompt => "天気を選択してください"},{class:"form-control"}%>
    </div>
    
    <div class="field form-group text-left">
        <div class="form-text  mb-3"><span class="badge badge-danger mr-1">※必須</span>住所</div><br />
        <%= form.text_field :address,class:"form-control" %>
    </div>
    <div data-toggle="modal" data-target="#modal1" class="btn btn-info mt-3 mb-3">
      <span class="badge badge-danger mr-1">※必須</span>地図で場所を選択する
    </div>
    
    <%= form.hidden_field :latitude,id:"map_lat" %>
    <%= form.hidden_field :longitude,id:"map_lng" %>
    
    <div class="actions">
        <%= form.submit value="登録する",class:"btn-lg btn-info mt-4 m-4"%>
        </div>
    <% end %>
  </div>    
</div> 


<div class="select-map">
    <div class="modal fade" id="modal1" tabindex="-1"
    role="dialog" aria-labelledby="label1" aria-hidden="true" class="mx-auto">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title " id="label1">地図で場所を選択</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="fishing-map" id="map" style='width: 100%; height: 550px;'></div>
                <script type="text/javascript">
                    var map;
                    var markerOnMap;
                    
                    function initMap() {
                        map = new google.maps.Map(document.getElementById('map'), { 
                            center: { 
                                lat: <%= @user.latitude %>,
                                lng: <%= @user.longitude %>
                            },
                            zoom: 8 
                        });
                        function placeMarker(location, map) { 
                            if (markerOnMap) {
                              markerOnMap.setPosition(location);
                            }
                            else {
                              markerOnMap = new google.maps.Marker({
                                position: location,
                                map: map,
                              });
                            }
                        }
                         google.maps.event.addListener(map, 'click', function(event) {
                            placeMarker(event.latLng, map);
                            document.getElementById("map_lat").value = event.latLng.lat();
                            document.getElementById("map_lng").value = event.latLng.lng();
                          })
                    }
                    initMap()
                </script>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn-sm btn-info" data-dismiss="modal">閉じる</button>
                </div>
            </div>
        </div>
    </div>
</div>