<%= link_to :back do %>
    <div class="mt-3 ml-3 back-btn"> < 戻る</div>
<% end %>
<div class="application-description">
    このページではGoogle Map上で釣果を見ることができます｡どこでどんな魚が釣れているのか確認してみましょう!
</div>
<div class="form-group text-center mt-5 mb-5">
    <%= form_with url:'/posts/search_fishing_map', method: :get, local: true do |form| %>
        <div class="search-form">
          <%= form.text_field :search ,class:"form-control" ,placeholder: "釣りたい魚で検索(カタカナで入力してください)"  %>
        </div>
      <%= form.submit '検索' ,class:"btn btn-info ml-3 mb-1" %>
    <% end %>
</div>

 <div class="mt-5" id="map" style='width: 100%; height: 650px;'></div>
 <script type="text/javascript">
            
            handler = Gmaps.build('Google');
            
            handler.buildMap({ provider: { scrollwheel: false }, internal: {id: 'map'}}, function(){
              markers = handler.addMarkers([
                  <% @posts.each do |post| %>
                {
                  "lat": <%= post.latitude %>,
                  "lng": <%= post.longitude %>,
        		  "infowindow": '<p><%= link_to "#{post.user.name}さんの釣果","/users/#{post.user.id}",class:"badge badge-info mt-3" %></p><div class="map-post-name"><%= post.name %></div><br/><% if post.image.attached? %><%= image_tag post.image,class:"map-icon-img mb-2" %><br><% else %><img src="../assets/sakana-img.jpg" class="default-img map-icon-img mb-2"><% end %><p><%= link_to "詳細",post ,class:"btn-sm btn-info"%></p>',
        		  "picture": {
        		       "url": '<%= asset_path "map-icon.png" %>',
		                "width":  48,
                        "height": 48
                    }
                },
                <% end %>
              ]);
              handler.bounds.extendWith(markers);
              handler.fitMapToBounds();
              var latlng = new google.maps.LatLng(<%= @user.latitude %>,<%= @user.longitude %>); 
              handler.getMap().setCenter(latlng,10);
            });
 </script>
<div class="pagenation">
    <%= paginate @posts%>
</div>


