<div class="bg-area text-center mt-5">
    <% if @user.bg_image.attached? %>
        <%= image_tag @user.bg_image,class:"bg-image"%>
    <% else %>
        <div>
            <i class="far fa-image no-bg-img"></i>
        </div>
        <div class="no-bg-text">
            まだ画像がありません
        </div>
    <% end %>
    <% if current_user && @user.id == current_user.id %>
        <div class="bg-img-edit mr-3" data-toggle="modal" data-target="#bg_edit">編集</div>
        <div class="bg-img-delete mr-1">
            <%= link_to"削除","/users/bg.img/delete",method:"post" %>
        </div>
    <% end %>
</div>
<div class="user-header">
    <div class="user-status row no-gutters">
        <div class="col-xs-12 col-md-2 text-center">
            <div class="user-img-area pt-3">
                <% if @user.image.attached? %>
                    <%= image_tag @user.image,class:"user-image"%>
                <% else %>
                    <img src="/assets/user-image.png" class="user-image">
                <% end %>
            </div>
            <% if current_user && @user.id == current_user.id %>
                <div class="profile-img-edit" data-toggle="modal" data-target="#img_edit">設定</div>
                <div class ="profile-img-delete">
                    <%= link_to"削除","/users/profile.img/delete",method:"post" %>
                </div>
            <% end %>
        </div>
        <div class="col-xs-12 col-md-1 text-center">
            <div class="user-name">
                <%= @user.name %>
            </div>
        </div>
        <div class="col-xs-12 col-md-3 text-center">
            <div class="follow-btn-group mx-auto">
                 <% if current_user && @user.id == current_user.id && !Relationship.find_by(follower_id: current_user.id,followed_id: @user.id) %>
                <div class="follow-btn">自分</div>
                <% elsif current_user && @user.id != current_user.id && Relationship.find_by(follower_id: current_user.id,followed_id: @user.id) %>
                    <%= form_with(model: current_user.active_relationships.find_by(followed_id: @user.id),local: true,html: { method: :delete }) do |form| %>
                        <%= form.submit "フォロー中", class: " unfollow-btn-lg" %>
                    <% end %>
                <% else %>
                   <%= form_with(model: Relationship.new(follower_id: current_user&.id, followed_id: @user.id),local: true) do|form| %>
                        <%= hidden_field_tag :followed_id, user.id %>
                        <%= form.submit "フォロー", class: "follow-btn-lg" %>
                    <% end %>
                <% end %>  
            </div>
        </div>
        <div class="col-xs-12 col-md-6 text-center">
            <% @user ||= current_user %>
            <div class="follow-group">
                <%= link_to("/users/#{@user.id}/following") do %>
                    <div class="header-follow-text mr-5">
                        フォロー <%= @user.following.count %>
                    </div>
                <% end %>
                <%= link_to("/users/#{@user.id}/followers") do %>
                    <div class="header-follow-text">
                        フォロワー <%= @user.followers.count %>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>
<%= render "bg_modal" %>
<%= render "profile_modal" %>


