<div class="bg-area text-center mt-5">
    <% if @user.bg_image.attached? %>
        <%= image_tag @user.bg_image,class:"bg-image"%>
    <% else %>
        <div>
            <i class="far fa-image no-bg-img"></i>
        </div>
        <div class="no-bg-text">
            まだ画像がありません
        </div>
    <% end %>
    <% if current_user && @user.id == current_user.id %>
        <div class="bg-img-edit mr-3" data-toggle="modal" data-target="#bg_edit">編集</div>
        <div class="bg-img-delete mr-1">
            <%= link_to"削除","/users/bg.img/delete",method:"post" %>
        </div>
    <% end %>
</div>
<div class="user-header">
    <div class="user-status row no-gutters">
        <div class="col-xs-12 col-md-2 text-center">
            <div class="user-img-area pt-3">
                <% if @user.image.attached? %>
                    <%= image_tag @user.image,class:"user-image"%>
                <% else %>
                    <img src="/assets/user-image.png" class="user-image">
                <% end %>
            </div>
            <% if current_user && @user.id == current_user.id %>
                <div class="profile-img-edit" data-toggle="modal" data-target="#img_edit">設定</div>
                <div class ="profile-img-delete">
                    <%= link_to"削除","/users/profile.img/delete",method:"post" %>
                </div>
            <% end %>
        </div>
        <div class="col-xs-12 col-md-1 text-center">
            <div class="user-name">
                <%= @user.name %>
            </div>
        </div>
        <div class="col-xs-12 col-md-3 text-center">
            <div class="follow-btn-group mx-auto">
                <% if current_user &&  @user.id != current_user.id %>
                    <% if  Relationship.find_by(follower_id: current_user.id,followed_id: @user.id) %>
                        <%= form_with(model: current_user.active_relationships.find_by(followed_id: @user.id),local: true,html: { method: :delete }) do |form| %>
                        <%= form.submit "フォロー中", class: " unfollow-btn-lg" %>
                    <% end %>
                <% else %>
                    <%= form_with(model: current_user.active_relationships.build,local: true) do|form| %>
                        <%= hidden_field_tag :followed_id, @user.id %>
                        <%= form.submit "フォローする", class: " follow-btn-lg" %>
                        <% end %>
                   <% end %>
                <% end %>
            </div>
        </div>
        <div class="col-xs-12 col-md-6 text-center">
            <% @user ||= current_user %>
            <div class="follow-group">
                <%= link_to("/users/#{@user.id}/following") do %>
                    <div class="header-follow-text mr-5">
                        フォロー <%= @user.following.count %>
                    </div>
                <% end %>
                <%= link_to("/users/#{@user.id}/followers") do %>
                    <div class="header-follow-text">
                        フォロワー <%= @user.followers.count %>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>


<!--モーダル-->
<div class="modal fade" id="img_edit" tabindex="-1"
      role="dialog" aria-labelledby="label1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="label1">プロフィール画像編集</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <%= form_with(model: @user,url:"/users/profile.img/edit",local: true ,method: :post) do |form| %>
                <img src="" class="img-preview">
                
                <% if @user.image.attached? %>
                    <div class="form-text">現在の画像</div>
                    <%= image_tag @user.image,class:"img-preview" %>
                <% end %>
                
                <div class="field form-group" onchange="previewFile()">
                    <%= form.file_field :image,id:"file" ,class:"form-control-file mt-3" %>
                </div>
                 <div class="modal-footer">
                    <div class="actions">
                        <%= form.submit "編集する" ,class:"btn btn-info mb-4"%>
                    </div>
                </div>
          <% end %>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="bg_edit" tabindex="-1"
      role="dialog" aria-labelledby="label1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="label1">背景画像編集</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <%= form_with(model: @user,url:"/users/bg.img/edit",local: true ,method: :post) do |form| %>
                <img src="" class="img-preview2">
                <% if @user.bg_image.attached? %>
                    <div class="form-text">現在の画像</div>
                    <%= image_tag @user.bg_image,class:"img-preview2" %>
                <% end %>
                
                <div class="field form-group" onchange="previewFile2()">
                    <%= form.file_field :bg_image ,class:"preview2",id:"bg" ,class:"form-control-file mt-3" %>
                </div>
                 <div class="modal-footer">
                    <div class="actions">
                        <%= form.submit "編集する" ,class:"btn btn-info mb-4"%>
                    </div>
                </div>
          <% end %>
      </div>
    </div>
  </div>
</div>

